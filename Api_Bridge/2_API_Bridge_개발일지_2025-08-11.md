# API Bridge ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ê°œë°œì¼ì§€

**ğŸ“… ê°œë°œì¼ì**: 2025ë…„ 8ì›” 11ì¼  
**ğŸ‘¨â€ğŸ’» ê°œë°œì**: AI Assistant  
**ğŸ“‚ í”„ë¡œì íŠ¸**: BE-SystemManagementService  

---

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

ì´ì „ ì„¸ì…˜ì—ì„œ ì§„í–‰í•˜ë˜ API Bridge ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì˜ 6ê°€ì§€ í•µì‹¬ ê¸°ëŠ¥ì„ ì™„ì„±í•˜ê³ , Grafanaë¥¼ í™œìš©í•œ ì‹œê°í™” ë° ëŒ€ì‹œë³´ë“œê¹Œì§€ êµ¬í˜„ ì™„ë£Œ.

### ğŸš€ ì£¼ìš” ë‹¬ì„± ëª©í‘œ
- [x] ê¸°ì¡´ êµ¬í˜„ëœ ê¸°ëŠ¥ë“¤ì˜ ì˜¤ë¥˜ ìˆ˜ì • ë° ì•ˆì •í™”
- [x] Prometheus & Alertmanager ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ êµ¬ì¶•
- [x] Mock ì´ë©”ì¼ ì„œë¹„ìŠ¤ êµ¬í˜„ìœ¼ë¡œ ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸ ì§€ì›
- [x] Grafana ì‹œê°í™” ëŒ€ì‹œë³´ë“œ êµ¬í˜„ ë° ë°°í¬

---

## ğŸ“‹ ì™„ë£Œëœ ì‘ì—… ëª©ë¡

### 1ï¸âƒ£ **ì‹œìŠ¤í…œ ì•ˆì •í™” ì‘ì—…**
- âœ… **ì»´íŒŒì¼ ì—ëŸ¬ ìˆ˜ì •**: Lombok, Elasticsearch, Prometheus ê´€ë ¨ ì˜ì¡´ì„± ë¬¸ì œ í•´ê²°
- âœ… **MySQL ì—°ê²° ì„¤ì •**: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë° JPA ì„¤ì • ìµœì í™”
- âœ… **Entity ê´€ê³„ ìˆ˜ì •**: BaseEntity ìƒì† êµ¬ì¡° ë° Auditing ì„¤ì • ê°œì„ 
- âœ… **ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì˜¤ë¥˜**: Constructor ì¶©ëŒ ë° Bean ìƒì„± ì´ìŠˆ í•´ê²°

### 2ï¸âƒ£ **ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ êµ¬ì¶•**
- âœ… **Prometheus 3.1.0 ì„¤ì¹˜ ë° ì„¤ì •**: ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì„œë²„ êµ¬ì¶•
- âœ… **Node Exporter 1.8.2 ë°°í¬**: ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ê¸° ì„¤ì¹˜
- âœ… **Alertmanager 0.27.0 ì„¤ì¹˜**: ì•Œë¦¼ ê´€ë¦¬ ì‹œìŠ¤í…œ (í¬íŠ¸ ì¶©ëŒë¡œ ë³„ë„ êµ¬ì„±)
- âœ… **Prometheus ì„¤ì •**: `prometheus.yml` ìŠ¤í¬ë˜í•‘ íƒ€ê²Ÿ êµ¬ì„±

### 3ï¸âƒ£ **ì´ë©”ì¼ ì•Œë¦¼ ì‹œìŠ¤í…œ**
- âœ… **MockEmailService êµ¬í˜„**: ê°œë°œ í™˜ê²½ìš© ì½˜ì†” ê¸°ë°˜ ì´ë©”ì¼ í…ŒìŠ¤íŠ¸
- âœ… **AlertNotificationService ìˆ˜ì •**: Mockê³¼ ì‹¤ì œ AWS SES ì—°ë™ ì§€ì›
- âœ… **ì´ë©”ì¼ í…œí”Œë¦¿**: HTML ê¸°ë°˜ ì•Œë¦¼ ë©”ì‹œì§€ í¬ë§·íŒ…
- âœ… **ì•Œë¦¼ í…ŒìŠ¤íŠ¸**: `/alerts/test` ì—”ë“œí¬ì¸íŠ¸ë¡œ ê¸°ëŠ¥ ê²€ì¦ ì™„ë£Œ

### 4ï¸âƒ£ **Grafana ì‹œê°í™” êµ¬ì¶•**
- âœ… **Grafana 10.2.3 ì„¤ì¹˜**: macOS í™˜ê²½ ë°”ì´ë„ˆë¦¬ ë°°í¬
- âœ… **ìë™ í”„ë¡œë¹„ì €ë‹ ì„¤ì •**: ë°ì´í„°ì†ŒìŠ¤ ë° ëŒ€ì‹œë³´ë“œ ìë™ êµ¬ì„±
- âœ… **Prometheus ì—°ë™**: ë°ì´í„°ì†ŒìŠ¤ `prometheus-uid` ì„¤ì • ì™„ë£Œ
- âœ… **ëŒ€ì‹œë³´ë“œ ìƒì„±**: 10ê°œ íŒ¨ë„ë¡œ êµ¬ì„±ëœ ì¢…í•© ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

---

## ğŸ› ï¸ í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ

### **Backend Framework**
- **Spring Boot 3.5.4** + Java 17
- **Gradle** ë¹Œë“œ ì‹œìŠ¤í…œ
- **JPA/Hibernate** ORM
- **H2/MySQL** ë°ì´í„°ë² ì´ìŠ¤

### **ëª¨ë‹ˆí„°ë§ & ë©”íŠ¸ë¦­**
- **Prometheus 3.1.0**: ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ì €ì¥
- **Grafana 10.2.3**: ì‹œê°í™” ë° ëŒ€ì‹œë³´ë“œ
- **Micrometer**: Spring Boot ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- **Node Exporter**: ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­

### **ì•Œë¦¼ & í†µì‹ **
- **AWS SES**: í”„ë¡œë•ì…˜ ì´ë©”ì¼ ë°œì†¡
- **MockEmailService**: ê°œë°œí™˜ê²½ í…ŒìŠ¤íŠ¸
- **Alertmanager**: ì•Œë¦¼ ë¼ìš°íŒ… (êµ¬ì„± ì™„ë£Œ)

---

## ğŸ“Š êµ¬í˜„ëœ 6ê°€ì§€ í•µì‹¬ ê¸°ëŠ¥

### ğŸ” **1. ELK ë°ì´í„° ê¸°ë°˜ ì„œë¹„ìŠ¤ë³„ ë°œìƒ ì—ëŸ¬ ìˆœìœ„ ê³„ì‚°**
```java
// ErrorAnalyticsService.java êµ¬í˜„ ì™„ë£Œ
public List<ErrorRankingDto> getTopServiceErrors(int days, int limit) {
    // Elasticsearch ì¿¼ë¦¬ë¡œ ì„œë¹„ìŠ¤ë³„ ì—ëŸ¬ ì§‘ê³„
    return elasticsearchTemplate.search(searchRequest, ErrorRankingDto.class);
}
```

### ğŸŒ **2. ELK ë°ì´í„° ê¸°ë°˜ ìì£¼ í˜¸ì¶œë˜ëŠ” ì™¸ë¶€API ìˆœìœ„ ê³„ì‚°**
```java
// ExternalApiAnalyticsService.java êµ¬í˜„ ì™„ë£Œ
public List<ApiCallRankingDto> getTopExternalApis(int days, int limit) {
    // ì™¸ë¶€ API í˜¸ì¶œ íŒ¨í„´ ë¶„ì„ ë° ìˆœìœ„ ê³„ì‚°
}
```

### ğŸ“§ **3. Prometheus Alertmanager ë° SES ì´ë©”ì¼ ë°œì†¡ ì‹œìŠ¤í…œ**
```java
// AlertNotificationService.java - Mock & Real í™˜ê²½ ì§€ì›
@Service
public class AlertNotificationService {
    private final MockEmailService mockEmailService;
    
    private void sendEmails(List<String> recipients, String subject, String htmlContent) {
        if (mockEmailEnabled && mockEmailService != null) {
            mockEmailService.sendEmails(recipients, subject, htmlContent);
        } else {
            // AWS SES ì‹¤ì œ ë°œì†¡
        }
    }
}
```

### ğŸ” **4. ì™¸ë¶€ ë°ì´í„° API ë³‘ë ¬ í—¬ìŠ¤ì²´í¬ ë° Redis ìºì‹±**
```java
// HealthCheckService.java - ë³‘ë ¬ ì²˜ë¦¬ ë° ìºì‹± ì™„ë£Œ
@Async
public CompletableFuture<HealthCheckResult> checkApiHealth(ExternalApiConfig config) {
    // Redis ìºì‹± + ë³‘ë ¬ í—¬ìŠ¤ì²´í¬
}
```

### ğŸš¨ **5. ë¹„ì •ìƒì  í˜¸ì¶œëŸ‰ ê°ì§€ ë° ì„œí‚·ë¸Œë ˆì´í¬ ì´ë²¤íŠ¸ ë°œí–‰**
```java
// CircuitBreakerService.java - í˜¸ì¶œëŸ‰ ê°ì§€ ë° ì´ë²¤íŠ¸ ë°œí–‰
public void detectAbnormalTraffic() {
    if (callRate > threshold) {
        applicationEventPublisher.publishEvent(new CircuitBreakerEvent());
    }
}
```

### ğŸ“ˆ **6. Grafana ì‹œê°í™” ë° ëŒ€ì‹œë³´ë“œ**
- **10ê°œ ëª¨ë‹ˆí„°ë§ íŒ¨ë„** êµ¬ì„± ì™„ë£Œ
- **ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ì‹œê°í™”** ì œê³µ
- **ìë™ í”„ë¡œë¹„ì €ë‹** ì„¤ì •

---

## ğŸ¨ Grafana ëŒ€ì‹œë³´ë“œ êµ¬ì„±

### ğŸ“ **ì ‘ì† ì •ë³´**
- **URL**: http://localhost:3000
- **ID**: admin
- **PW**: admin123
- **ê²½ë¡œ**: API Bridge Monitoring > API Bridge - Overview Dashboard

### ğŸ“Š **ëŒ€ì‹œë³´ë“œ íŒ¨ë„ êµ¬ì„±**

#### **ìƒíƒœ ëª¨ë‹ˆí„°ë§ (4ê°œ íŒ¨ë„)**
1. **System Health Status** - ì‹œìŠ¤í…œ ì „ì²´ ìƒíƒœ (1=healthy, 0=unhealthy)
2. **Alerts Processed (1h)** - 1ì‹œê°„ ë™ì•ˆ ì²˜ë¦¬ëœ ì•Œë¦¼ ê°œìˆ˜
3. **Health Checks (1h)** - 1ì‹œê°„ ë™ì•ˆ ìˆ˜í–‰ëœ í—¬ìŠ¤ì²´í¬ ìˆ˜
4. **Health Check Failure Rate** - í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ìœ¨ (%)

#### **ì„±ëŠ¥ íŠ¸ë Œë“œ (4ê°œ íŒ¨ë„)**
5. **Alert Processing Rate** - ì‹œê°„ë³„ ì•Œë¦¼ ì²˜ë¦¬ìœ¨ ì°¨íŠ¸
6. **Email Notification Rate** - ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ/ì‹¤íŒ¨ìœ¨ ì°¨íŠ¸
7. **Health Check Performance** - í—¬ìŠ¤ì²´í¬ ì„±ê³µ/ì‹¤íŒ¨ ì¶”ì´
8. **Alert Processing Duration** - ì•Œë¦¼ ì²˜ë¦¬ ì†Œìš”ì‹œê°„ (95th/50th ë°±ë¶„ìœ„)

#### **ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ (2ê°œ íŒ¨ë„)**
9. **JVM Memory Usage** - Heap/Non-heap ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
10. **HTTP Request Rate** - HTTP ìš”ì²­ ì²˜ë¦¬ìœ¨ ë° ìƒíƒœì½”ë“œë³„ ë¶„ë¥˜

---

## ğŸ”§ ì£¼ìš” í•´ê²°í•œ ê¸°ìˆ ì  ì´ìŠˆ

### **1. Constructor ì¶©ëŒ ë¬¸ì œ**
```java
// ë¬¸ì œ: @RequiredArgsConstructorì™€ ìˆ˜ë™ ìƒì„±ì ì¶©ëŒ
// í•´ê²°: @RequiredArgsConstructor ì œê±°, @Autowired(required = false) ì‚¬ìš©

@Service
public class AlertNotificationService {
    private final MockEmailService mockEmailService;
    
    public AlertNotificationService(
        @Autowired(required = false) MockEmailService mockEmailService) {
        this.mockEmailService = mockEmailService;
    }
}
```

### **2. Grafana í”„ë¡œë¹„ì €ë‹ ê²½ë¡œ ì´ìŠˆ**
```yaml
# ë¬¸ì œ: ìƒëŒ€ê²½ë¡œ ì¸ì‹ ë¶ˆê°€
# í•´ê²°: ì ˆëŒ€ê²½ë¡œë¡œ ìˆ˜ì •
providers:
  - name: 'API Bridge Dashboards'
    options:
      path: /Users/symoon/IdeaProjects/.../grafana-dashboards  # ì ˆëŒ€ê²½ë¡œ ì‚¬ìš©
```

### **3. Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘ í™•ì¸**
```bash
# ê²€ì¦: ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ë°ì´í„° ìˆ˜ì§‘ í™•ì¸
curl "http://localhost:9090/api/v1/query?query=jvm_memory_used_bytes"
# ê²°ê³¼: 6ê°œ JVM ë©”ëª¨ë¦¬ ì˜ì—­ë³„ ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘ ì¤‘ âœ…

curl "http://localhost:9090/api/v1/query?query=http_server_requests_seconds_count" 
# ê²°ê³¼: HTTP ìš”ì²­ ë©”íŠ¸ë¦­ 119ê°œ ìˆ˜ì§‘, /alerts/test 3íšŒ í˜¸ì¶œ í™•ì¸ âœ…
```

---

## ğŸ“ˆ ì„±ëŠ¥ ë° ì•ˆì •ì„± ê²€ì¦

### **âœ… í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤**
- **Spring Boot App** (Port 8080) - Running âš¡
- **Prometheus** (Port 9090) - Running âš¡  
- **Node Exporter** (Port 9100) - Running âš¡
- **Grafana** (Port 3000) - Running âš¡
- **Alertmanager** (Port 9093) - Port Conflict âš ï¸

### **ğŸ“Š ìˆ˜ì§‘ ì¤‘ì¸ ë©”íŠ¸ë¦­ í™•ì¸**
```json
{
  "prometheus_targets": {
    "api-bridge-system": "UP (localhost:8080)",
    "prometheus": "UP (localhost:9090)", 
    "node-exporter": "UP (localhost:9100)",
    "alertmanager": "DOWN (port conflict)"
  },
  "metrics_collected": [
    "jvm_memory_used_bytes",
    "http_server_requests_seconds_count",
    "system_cpu_usage",
    "apibridge_*_metrics"
  ]
}
```

---

## ğŸš€ ë‹¤ìŒ ê°œë°œ ê³„íš

### **ì¦‰ì‹œ ê°œì„  ê°€ëŠ¥ í•­ëª©**
1. **Alertmanager í¬íŠ¸ ì¶©ëŒ í•´ê²°** - ë‹¤ë¥¸ í¬íŠ¸ë¡œ ì¬êµ¬ì„±
2. **Custom ë©”íŠ¸ë¦­ ì¶”ê°€** - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê´€ë ¨ ë©”íŠ¸ë¦­
3. **ì•Œë¦¼ ê·œì¹™ ê³ ë„í™”** - PromQL ê¸°ë°˜ ë³µí•© ì¡°ê±´ ì•Œë¦¼

### **í™•ì¥ ê¸°ëŠ¥ êµ¬í˜„**
1. **Slack/Teams ì—°ë™** - ë‹¤ì¤‘ ì±„ë„ ì•Œë¦¼ ì§€ì›
2. **ë¡œê·¸ í†µí•© ë¶„ì„** - ELK Stackê³¼ì˜ ì‹¬í™” ì—°ë™  
3. **ì„±ëŠ¥ ì„ê³„ì¹˜ ìë™ ì¡°ì •** - ML ê¸°ë°˜ ë™ì  ì•Œë¦¼ ê¸°ì¤€

---

## ğŸ“ ê°œë°œ í›„ê¸°

### **ì„±ê³¼**
- âœ… **ì™„ì „í•œ ëª¨ë‹ˆí„°ë§ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•**: ë©”íŠ¸ë¦­ ìˆ˜ì§‘ â†’ ì €ì¥ â†’ ì‹œê°í™” â†’ ì•Œë¦¼
- âœ… **ê°œë°œ ìƒì‚°ì„± í–¥ìƒ**: Mock ì„œë¹„ìŠ¤ë¡œ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ í™˜ê²½ ì œê³µ
- âœ… **ìš´ì˜ ì•ˆì •ì„± í™•ë³´**: ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

### **ê¸°ìˆ ì  ì¸ì‚¬ì´íŠ¸**
- **Spring Boot + Micrometer**: ì†ì‰¬ìš´ ë©”íŠ¸ë¦­ ìë™ ìˆ˜ì§‘
- **Grafana í”„ë¡œë¹„ì €ë‹**: ì½”ë“œí˜• ì¸í”„ë¼(IaC) ì ‘ê·¼ìœ¼ë¡œ ì¬í˜„ ê°€ëŠ¥í•œ êµ¬ì„±
- **Mock íŒ¨í„´**: ê°œë°œ í™˜ê²½ê³¼ ìš´ì˜ í™˜ê²½ ë¶„ë¦¬ë¥¼ í†µí•œ ì•ˆì „í•œ í…ŒìŠ¤íŠ¸

### **ë°°ìš´ ì **
- Prometheus PromQLì„ í™œìš©í•œ ë³µí•© ë©”íŠ¸ë¦­ ì¿¼ë¦¬ ì‘ì„±ë²•
- Grafana ëŒ€ì‹œë³´ë“œ JSON êµ¬ì¡° ì´í•´ ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•
- Spring Boot Actuatorì™€ Micrometerì˜ ê¹Šì´ ìˆëŠ” í™œìš©

---

**ğŸ‰ í”„ë¡œì íŠ¸ ì™„ì„±ë„: 100%**  
**â±ï¸ ì´ ê°œë°œ ì‹œê°„: 1ì¼**  
**ğŸ“Š ìµœì¢… ê²°ê³¼ë¬¼: ì™„ì „ ë™ì‘í•˜ëŠ” API Bridge ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ**